<p>{{ num }}. Step: {{ stepSignal().eventType }}</p>

<div class="funnel-step">
  <div class="filter-row">
    <select id="event" [(ngModel)]="stepSignal().eventType">
      <option value="Unnamed step" disabled>Select an event</option>

      @for (event of availableEvents; track $index) {
      <option [value]="event">{{ event }}</option>
      }
    </select>

    <div>
      @if (stepSignal().eventType !== 'Unnamed step' && hasActiveFilters()) { @for (filter of
      stepSignal().filters ?? [{attribute: '', operator: '', value: ['']}]; track $index) {
      <div>
        <attribute
          [attributes]="propertiesForEvent"
          [selected]="filter?.attribute ?? ''"
          (selectedChange)="updateFilter($index, 'attribute', $event)"
        >
        </attribute>

        <operator
          [type]="filter.type ?? 'string'"
          [selected]="filter.operator"
          (selectedChange)="updateFilter($index, 'operator', $event)"
        >
        </operator>
        @if (filter.operator === 'in between') {
        <input
          type="text"
          [value]="filter.value?.[0] ?? ''"
          (input)="updateFilter($index, 'value', [$event.target.value, filter.value?.[1] ?? ''])"
        />
        and
        <input
          type="text"
          [value]="filter.value?.[1] ?? ''"
          (input)="updateFilter($index, 'value', [filter.value?.[0] ?? '', $event.target.value])"
        />
        } @else {

        <input
          type="text"
          [value]="filter.value?.[0] ?? ''"
          (input)="updateFilter($index, 'value', $event.target.value)"
        />
        }
        <span class="remove-filter" (click)="removeFilter($index)">X</span>

        @if ($last === false) {
        <div class="filter-separator">AND</div>
        }
      </div>
      }}@if (stepSignal().eventType !== 'Unnamed step') {
      <a class="refine-link" (click)="addFilter()"
        >@if (hasActiveFilters()) {Refine more} @else {Add filter}</a
      >
      }
    </div>
  </div>
</div>
